<!DOCTYPE html>
<html>
    <head>
        <title>Platformer</title>
        <style>
            canvas { border: 1px solid #ffffff; display: block; margin: 20px auto; background: #ffffff; }
            body { background-color: black;}
            p { color: white}
            a { color: white;}
        </style>
        <link rel="icon" type="image/x-icon" href="../appimages/platfor.png">
    </head>
    <body>
        <canvas id="gameMap" width="1200" height="600"></canvas>
        <script>
const gameMap = document.getElementById("gameMap");
const ctx = gameMap.getContext("2d");

function getRandomInt(max) {
    return Math.floor(Math.random() * max); 
}

let dead = false;

const gravity = 0.8;
const friction = 0.9;

let size = 40;

function dude(x, y) {
    this.x = x;
    this.y = y;
    this.w = size;
    this.h = size;
    this.velX = 0;
    this.velY = 0;
    this.jumpStrength = -15;
    this.grounded = false;
}

function enemy(x, y) {
    this.x = x;
    this.y = y;
    this.w = 40;
    this.h = 40;
    this.velX = 0;
    this.velY = 0;
    this.jumpStrength = -15;
    this.grounded = false;
}

const platforms = [
    { x: 50, y: 500, w: 200, h: 25 },
    { x: 350, y: 500, w: 200, h: 25 },
    { x: 650, y: 500, w: 200, h: 25 },
    { x: 950, y: 500, w: 200, h: 25 },
    { x: 50, y: 400, w: 200, h: 25 },
    { x: 350, y: 400, w: 200, h: 25 },
    { x: 650, y: 400, w: 200, h: 25 },
    { x: 950, y: 400, w: 200, h: 25 }
];

dude.prototype.update = function() {
    this.velY += gravity;
    this.y += this.velY;
    this.x += this.velX;
    
    this.velX *= friction;
    this.grounded = false;

    if (this.y + this.h > gameMap.height) {
        this.y = gameMap.height - this.h;
        this.velY = 0;
        this.grounded = true;
    }

    platforms.forEach(plat => {
        if (this.x < plat.x + plat.w &&
            this.x + this.w > plat.x &&
            this.y < plat.y + plat.h &&
            this.y + this.h > plat.y) {
            
            if (this.velY > 0 && this.y + this.h - this.velY <= plat.y) {
                this.y = plat.y - this.h;
                this.velY = 0;
                this.grounded = true;
            }
        }
    });

    if (this.x < 0) this.x = 0;
    if (this.x + this.w > gameMap.width) this.x = gameMap.width - this.w;

    if (!dead) {
        ctx.fillStyle = "blue";
    } else {
        ctx.fillStyle = "grey";
    }
    ctx.fillRect(this.x, this.y, this.w, this.h);
}

enemy.prototype.update = function(p) {
    this.velY += gravity;
    this.y += this.velY;
    this.x += this.velX;
    
    this.velX *= friction;
    this.grounded = false;

    if (this.y + this.h > gameMap.height) {
        this.y = gameMap.height - this.h;
        this.velY = 0;
        this.grounded = true;
    }

    platforms.forEach(plat => {
        if (this.x < plat.x + plat.w &&
            this.x + this.w > plat.x &&
            this.y < plat.y + plat.h &&
            this.y + this.h > plat.y) {
            
            if (this.velY > 0 && this.y + this.h - this.velY <= plat.y) {
                this.y = plat.y - this.h;
                this.velY = 0;
                this.grounded = true;
            }
        }
    });

    if (this.x < 0) this.x = 0;
    if (this.x + this.w > gameMap.width) this.x = gameMap.width - this.w;

    if (p.x > this.x) {
        this.velX += 0.5;
    }
    if (p.x < this.x) {
        this.velX -= 0.5;
    }
    if (p.y < this.y && this.grounded && Math.abs(this.x - p.x) <= 100) {
        this.velY = this.jumpStrength;
    }

    if (Math.abs(this.x - p.x) <= this.w && Math.abs(this.y - p.y) <= this.w) {
        dead = true;
    }

    ctx.fillStyle = "red";
    ctx.fillRect(this.x, this.y, this.w, this.h);
}

const guy = new dude(0, 0);
const a = new enemy(400, 600);
const keys = {};

document.addEventListener('keydown', (e) => {
    keys[e.code] = true;
    if (e.code === 'Space' && guy.grounded) {
        guy.velY = guy.jumpStrength;
    }
});

document.addEventListener('keyup', (e) => {
    keys[e.code] = false;
});

function animate() {
    ctx.clearRect(0, 0, gameMap.width, gameMap.height);

    ctx.fillStyle = "green";
    platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

    if (!dead) {
        if (keys['KeyD']) {
            guy.velX += 1;
        }
        if (keys['KeyA']) {
            guy.velX -= 1;
        }
    } 
    guy.update();
    a.update(guy);
    requestAnimationFrame(animate);
}

animate();
        </script>
    </body>
</html>